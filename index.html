
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>FVG Trading Bot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); color: #fff; min-height: 100vh; }
        .container { max-width: 500px; margin: 0 auto; padding: 10px; }
        
        .header { background: rgba(30, 41, 59, 0.5); padding: 15px; border-radius: 15px; margin-bottom: 15px; border: 1px solid #334155; }
        .header-top { display: flex; justify-content: space-between; align-items: center; }
        .header-title { display: flex; align-items: center; gap: 10px; }
        .icon { width: 40px; height: 40px; background: linear-gradient(135deg, #3b82f6, #8b5cf6); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .title { font-size: 18px; font-weight: bold; }
        .subtitle { font-size: 12px; color: #94a3b8; margin-top: 2px; }
        
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 14px; }
        .btn-settings { background: rgba(51, 65, 85, 0.5); color: #cbd5e1; width: 40px; height: 40px; padding: 0; }
        .btn-start { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .btn-stop { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .btn-primary { background: rgba(59, 130, 246, 0.2); color: #3b82f6; width: 100%; margin-top: 10px; }
        
        .card { background: rgba(30, 41, 59, 0.5); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #334155; }
        
        .status-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .status-info { display: flex; align-items: center; gap: 8px; }
        .status-dot { width: 10px; height: 10px; border-radius: 50%; background: #475569; }
        .status-dot.active { background: #22c55e; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat { background: rgba(51, 65, 85, 0.3); padding: 12px; border-radius: 10px; text-align: center; }
        .stat.bullish { background: rgba(34, 197, 94, 0.1); }
        .stat.bearish { background: rgba(239, 68, 68, 0.1); }
        .stat-value { font-size: 24px; font-weight: bold; }
        .stat.bullish .stat-value { color: #22c55e; }
        .stat.bearish .stat-value { color: #ef4444; }
        .stat-label { font-size: 11px; color: #94a3b8; margin-top: 5px; }
        
        .config { display: none; }
        .config.show { display: block; }
        .form-group { margin-bottom: 12px; }
        .form-label { display: block; font-size: 12px; color: #94a3b8; margin-bottom: 5px; }
        .form-input, .form-select { width: 100%; padding: 10px; background: rgba(51, 65, 85, 0.5); border: 1px solid #475569; border-radius: 8px; color: #fff; font-size: 14px; }
        
        .signal { background: rgba(34, 197, 94, 0.05); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 12px; margin-bottom: 10px; }
        .signal.bearish { background: rgba(239, 68, 68, 0.05); border-color: rgba(239, 68, 68, 0.2); }
        .signal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .signal-type { font-weight: bold; color: #22c55e; }
        .signal.bearish .signal-type { color: #ef4444; }
        .signal-time { font-size: 11px; color: #64748b; }
        .signal-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px; }
        .signal-item { }
        .signal-item-label { color: #64748b; }
        .signal-item-value { font-weight: bold; color: #fff; }
        .signal-item-value.green { color: #22c55e; }
        .signal-item-value.red { color: #ef4444; }
        .signal-item-value.blue { color: #3b82f6; }
        
        .empty { text-align: center; padding: 40px 20px; color: #64748b; }
        .last-check { text-align: center; font-size: 11px; color: #475569; margin-top: 10px; }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <div class="icon">üìä</div>
                    <div>
                        <div class="title">FVG Trading Bot</div>
                        <div class="subtitle" id="symbolDisplay">BTC/USDT ‚Ä¢ 15m</div>
                    </div>
                </div>
                <button class="btn btn-settings" onclick="toggleConfig()">‚öôÔ∏è</button>
            </div>
        </div>

        <!-- Status Card -->
        <div class="card">
            <div class="status-row">
                <div class="status-info">
                    <div class="status-dot" id="statusDot"></div>
                    <span id="statusText">Stopped</span>
                </div>
                <button class="btn btn-start" id="toggleBtn" onclick="toggleBot()">Start Bot</button>
            </div>
            
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="totalSignals">0</div>
                    <div class="stat-label">Total Signals</div>
                </div>
                <div class="stat bullish">
                    <div class="stat-value" id="bullishSignals">0</div>
                    <div class="stat-label">Bullish</div>
                </div>
                <div class="stat bearish">
                    <div class="stat-value" id="bearishSignals">0</div>
                    <div class="stat-label">Bearish</div>
                </div>
            </div>
            
            <div class="last-check" id="lastCheck"></div>
        </div>

        <!-- Configuration -->
        <div class="card config" id="configPanel">
            <h3 style="margin-bottom: 15px;">Configuration</h3>
            
            <div class="form-group">
                <label class="form-label">Trading Pair</label>
                <select class="form-select" id="symbolInput" onchange="saveConfig()">
                    <option value="BTCUSDT">BTC/USDT</option>
                    <option value="ETHUSDT">ETH/USDT</option>
                    <option value="BNBUSDT">BNB/USDT</option>
                    <option value="SOLUSDT">SOL/USDT</option>
                    <option value="ADAUSDT">ADA/USDT</option>
                    <option value="XRPUSDT">XRP/USDT</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Timeframe</label>
                <select class="form-select" id="timeframeInput" onchange="saveConfig()">
                    <option value="1m">1 Minute</option>
                    <option value="5m">5 Minutes</option>
                    <option value="15m">15 Minutes</option>
                    <option value="30m">30 Minutes</option>
                    <option value="1h">1 Hour</option>
                    <option value="4h">4 Hours</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label">Check Interval (seconds)</label>
                <input type="number" class="form-input" id="intervalInput" value="60" min="10" onchange="saveConfig()">
            </div>

            <div class="form-group">
                <label class="form-label">Discord Webhook URL</label>
                <input type="text" class="form-input" id="webhookInput" placeholder="https://discord.com/api/webhooks/..." onchange="saveConfig()">
            </div>

            <button class="btn btn-primary" onclick="toggleConfig()">Save & Close</button>
        </div>

        <!-- Signals -->
        <div class="card">
            <h3 style="margin-bottom: 15px;">Recent Signals</h3>
            <div id="signalsList">
                <div class="empty">No signals yet. Start the bot to receive trading signals.</div>
            </div>
        </div>
    </div>

    <script>
        let bot = {
            isRunning: false,
            symbol: 'BTCUSDT',
            timeframe: '15m',
            interval: 60,
            webhook: '',
            signals: [],
            stats: { total: 0, bullish: 0, bearish: 0 },
            sentSignals: new Set(),
            usedSwings: new Set(),
            intervalId: null
        };

        function loadConfig() {
            const saved = localStorage.getItem('tradingBot');
            if (saved) {
                const data = JSON.parse(saved);
                bot = { ...bot, ...data };
                bot.sentSignals = new Set(data.sentSignals || []);
                bot.usedSwings = new Set(data.usedSwings || []);
            }
            document.getElementById('symbolInput').value = bot.symbol;
            document.getElementById('timeframeInput').value = bot.timeframe;
            document.getElementById('intervalInput').value = bot.interval;
            document.getElementById('webhookInput').value = bot.webhook;
            updateDisplay();
        }

        function saveConfig() {
            bot.symbol = document.getElementById('symbolInput').value;
            bot.timeframe = document.getElementById('timeframeInput').value;
            bot.interval = parseInt(document.getElementById('intervalInput').value) || 60;
            bot.webhook = document.getElementById('webhookInput').value;
            
            const data = {
                symbol: bot.symbol,
                timeframe: bot.timeframe,
                interval: bot.interval,
                webhook: bot.webhook,
                signals: bot.signals,
                stats: bot.stats,
                sentSignals: Array.from(bot.sentSignals),
                usedSwings: Array.from(bot.usedSwings)
            };
            localStorage.setItem('tradingBot', JSON.stringify(data));
            updateDisplay();
        }

        function toggleConfig() {
            const panel = document.getElementById('configPanel');
            panel.classList.toggle('show');
        }

        function toggleBot() {
            if (!bot.webhook) {
                alert('Please configure Discord Webhook URL first!');
                toggleConfig();
                return;
            }
            
            if (bot.isRunning) {
                stopBot();
            } else {
                startBot();
            }
        }

        function startBot() {
            bot.isRunning = true;
            document.getElementById('statusDot').classList.add('active');
            document.getElementById('statusText').textContent = 'Running';
            document.getElementById('toggleBtn').textContent = 'Stop Bot';
            document.getElementById('toggleBtn').className = 'btn btn-stop';
            
            checkMarket();
            bot.intervalId = setInterval(checkMarket, bot.interval * 1000);
        }

        function stopBot() {
            bot.isRunning = false;
            document.getElementById('statusDot').classList.remove('active');
            document.getElementById('statusText').textContent = 'Stopped';
            document.getElementById('toggleBtn').textContent = 'Start Bot';
            document.getElementById('toggleBtn').className = 'btn btn-start';
            
            if (bot.intervalId) {
                clearInterval(bot.intervalId);
                bot.intervalId = null;
            }
        }

        async function checkMarket() {
            document.getElementById('lastCheck').textContent = 'Last check: ' + new Date().toLocaleTimeString();
            
            try {
                const candles = await fetchCandles();
                if (!candles || candles.length < 5) return;

                const fvgs = detectFVG(candles);
                if (fvgs.length === 0) return;

                const latestFvg = fvgs[fvgs.length - 1];
                const swing = detectSwing(candles, latestFvg);
                
                if (!swing) return;

                const swingKey = swing.timestampStart + '_' + swing.timestampMid;
                const signalKey = latestFvg.type + '_' + latestFvg.timestamp + '_' + swing.timestampMid;

                if (bot.usedSwings.has(swingKey) || bot.sentSignals.has(signalKey)) return;

                const currentPrice = candles[candles.length - 1][4];
                const signal = calculateSignal(latestFvg, swing, currentPrice);
                
                await sendToDiscord(signal);
                
                bot.sentSignals.add(signalKey);
                bot.usedSwings.add(swingKey);
                bot.signals.unshift(signal);
                bot.signals = bot.signals.slice(0, 20);
                bot.stats.total++;
                if (signal.type === 'bullish') bot.stats.bullish++;
                else bot.stats.bearish++;
                
                saveConfig();
                updateDisplay();
            } catch (error) {
                console.error('Error:', error);
            }
        }

        async function fetchCandles() {
            const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${bot.symbol}&interval=${bot.timeframe}&limit=100`);
            const data = await response.json();
            return data.map(c => [parseInt(c[0]), parseFloat(c[1]), parseFloat(c[2]), parseFloat(c[3]), parseFloat(c[4])]);
        }

        function detectFVG(candles) {
            const fvgs = [];
            for (let i = 2; i < candles.length; i++) {
                if (candles[i][3] > candles[i-2][2]) {
                    fvgs.push({ type: 'bullish', index: i, top: candles[i][3], bottom: candles[i-2][2], timestamp: candles[i][0] });
                } else if (candles[i][2] < candles[i-2][3]) {
                    fvgs.push({ type: 'bearish', index: i, top: candles[i-2][3], bottom: candles[i][2], timestamp: candles[i][0] });
                }
            }
            return fvgs;
        }

        function detectSwing(candles, fvg) {
            const swings = [];
            const start = Math.max(3, fvg.index - 15);
            
            for (let i = start; i < fvg.index - 2; i++) {
                const c1 = candles[i], c2 = candles[i+1], c3 = candles[i+2];
                
                if (fvg.type === 'bullish' && c2[3] < c1[3] && c2[3] < c3[3]) {
                    swings.push({ type: 'swing_low', swingPoint: c2[3], timestampStart: c1[0], timestampMid: c2[0] });
                } else if (fvg.type === 'bearish' && c2[2] > c1[2] && c2[2] > c3[2]) {
                    swings.push({ type: 'swing_high', swingPoint: c2[2], timestampStart: c1[0], timestampMid: c2[0] });
                }
            }
            
            return swings.length > 0 ? swings[swings.length - 1] : null;
        }

        function calculateSignal(fvg, swing, price) {
            const range = fvg.top - fvg.bottom;
            let entry, stop, tp1, tp2, risk, reward;
            
            if (fvg.type === 'bullish') {
                entry = fvg.bottom;
                stop = swing.swingPoint * 0.997;
                tp1 = fvg.top;
                tp2 = fvg.top + (range * 1.5);
                risk = entry - stop;
                reward = tp2 - entry;
            } else {
                entry = fvg.top;
                stop = swing.swingPoint * 1.003;
                tp1 = fvg.bottom;
                tp2 = fvg.bottom - (range * 1.5);
                risk = stop - entry;
                reward = entry - tp2;
            }
            
            return {
                id: Date.now(),
                type: fvg.type,
                timestamp: new Date().toISOString(),
                price: price,
                entry: entry,
                stop: stop,
                tp1: tp1,
                tp2: tp2,
                rr: (reward / risk).toFixed(2)
            };
        }

        async function sendToDiscord(signal) {
            const embed = {
                title: `üéØ ${signal.type.toUpperCase()} SIGNAL`,
                description: `**${bot.symbol}** | ${bot.timeframe}\n‚úÖ FVG + 3-Candle Swing`,
                color: signal.type === 'bullish' ? 3066993 : 15158332,
                fields: [
                    { name: 'üí∞ Price', value: `$${signal.price.toFixed(2)}`, inline: true },
                    { name: 'üü¢ Entry', value: `$${signal.entry.toFixed(2)}`, inline: true },
                    { name: '‚è∏Ô∏è Stop', value: `$${signal.stop.toFixed(2)}`, inline: true },
                    { name: 'üéÅ TP1', value: `$${signal.tp1.toFixed(2)}`, inline: true },
                    { name: 'üéÅ TP2', value: `$${signal.tp2.toFixed(2)}`, inline: true },
                    { name: 'üìè R:R', value: `1:${signal.rr}`, inline: true }
                ],
                timestamp: new Date().toISOString()
            };
            
            await fetch(bot.webhook, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ embeds: [embed] })
            });
        }

        function updateDisplay() {
            document.getElementById('symbolDisplay').textContent = `${bot.symbol} ‚Ä¢ ${bot.timeframe}`;
            document.getElementById('totalSignals').textContent = bot.stats.total;
            document.getElementById('bullishSignals').textContent = bot.stats.bullish;
            document.getElementById('bearishSignals').textContent = bot.stats.bearish;
            
            const list = document.getElementById('signalsList');
            if (bot.signals.length === 0) {
                list.innerHTML = '<div class="empty">No signals yet. Start the bot to receive trading signals.</div>';
            } else {
                list.innerHTML = bot.signals.map(s => `
                    <div class="signal ${s.type}">
                        <div class="signal-header">
                            <span class="signal-type">${s.type.toUpperCase()} SIGNAL</span>
                            <span class="signal-time">${new Date(s.timestamp).toLocaleTimeString()}</span>
                        </div>
                        <div class="signal-grid">
                            <div class="signal-item">
                                <div class="signal-item-label">Price</div>
                                <div class="signal-item-value">$${s.price.toFixed(2)}</div>
                            </div>
                            <div class="signal-item">
                                <div class="signal-item-label">Entry</div>
                                <div class="signal-item-value">$${s.entry.toFixed(2)}</div>
                            </div>
                            <div class="signal-item">
                                <div class="signal-item-label">Stop Loss</div>
                                <div class="signal-item-value red">$${s.stop.toFixed(2)}</div>
                            </div>
                            <div class="signal-item">
                                <div class="signal-item-label">TP1</div>
                                <div class="signal-item-value green">$${s.tp1.toFixed(2)}</div>
                            </div>
                            <div class="signal-item">
                                <div class="signal-item-label">TP2</div>
                                <div class="signal-item-value green">$${s.tp2.toFixed(2)}</div>
                            </div>
                            <div class="signal-item">
                                <div class="signal-item-label">Risk:Reward</div>
                                <div class="signal-item-value blue">1:${s.rr}</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        loadConfig();
    </script>
</body>
</html>
