<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FVG CHoCH Bot</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #1e293b, #0f172a); color: #fff; min-height: 100vh; }
        .container { max-width: 500px; margin: 0 auto; padding: 10px; }
        .card { background: rgba(30, 41, 59, 0.5); border-radius: 15px; padding: 15px; margin-bottom: 15px; border: 1px solid #334155; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .btn { padding: 10px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
        .btn-start { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .btn-stop { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .btn-primary { background: rgba(59, 130, 246, 0.2); color: #3b82f6; width: 100%; margin-top: 10px; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat { background: rgba(51, 65, 85, 0.3); padding: 12px; border-radius: 10px; text-center; }
        .stat-value { font-size: 24px; font-weight: bold; }
        .form-input, .form-select { width: 100%; padding: 10px; background: rgba(51, 65, 85, 0.5); border: 1px solid #475569; border-radius: 8px; color: #fff; margin: 8px 0; }
        .hidden { display: none; }
        .config { display: none; }
        .config.show { display: block; }
        .zone-item { background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 10px; padding: 12px; margin: 10px 0; }
        .zone-item.broken { opacity: 0.5; background: rgba(239, 68, 68, 0.1); }
        .signal { background: rgba(34, 197, 94, 0.05); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 12px; padding: 12px; margin: 10px 0; }
        .signal.bearish { background: rgba(239, 68, 68, 0.05); border-color: rgba(239, 68, 68, 0.2); }
        .signal-badge { display: inline-block; padding: 4px 8px; border-radius: 6px; font-size: 10px; margin: 5px 5px 0 0; }
        .signal-badge.fvg { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .signal-badge.choch { background: rgba(168, 85, 247, 0.2); color: #a855f7; }
        .tab-buttons { display: flex; gap: 5px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 10px; background: rgba(51, 65, 85, 0.3); border: none; border-radius: 8px; color: #94a3b8; cursor: pointer; }
        .tab-btn.active { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div>
                    <h2>FVG CHoCH Bot</h2>
                    <small id="symbolDisplay">BTC/USDT ‚Ä¢ 15m</small>
                </div>
                <button class="btn" onclick="toggleConfig()">‚öôÔ∏è</button>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                <span id="statusText">Stopped</span>
                <button class="btn btn-start" id="toggleBtn" onclick="toggleBot()">Start</button>
            </div>
            <div class="stats">
                <div class="stat"><div class="stat-value" id="totalSignals">0</div><small>Total</small></div>
                <div class="stat"><div class="stat-value" id="bullishSignals" style="color:#22c55e">0</div><small>Bullish</small></div>
                <div class="stat"><div class="stat-value" id="bearishSignals" style="color:#ef4444">0</div><small>Bearish</small></div>
            </div>
        </div>

        <div class="card config" id="configPanel">
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab(event,'basic')">Basic</button>
                <button class="tab-btn" onclick="switchTab(event,'zones')">Zones</button>
                <button class="tab-btn" onclick="switchTab(event,'advanced')">Advanced</button>
            </div>

            <div id="basicTab" class="tab-content active">
                <label>Symbol</label>
                <select class="form-select" id="symbolInput" onchange="saveConfig()">
                    <option value="BTCUSDT">BTC/USDT</option>
                    <option value="ETHUSDT">ETH/USDT</option>
                </select>
                <label>Timeframe</label>
                <select class="form-select" id="timeframeInput" onchange="saveConfig()">
                    <option value="5m">5m</option>
                    <option value="15m">15m</option>
                    <option value="1h">1h</option>
                </select>
                <label>Webhook</label>
                <input class="form-input" id="webhookInput" onchange="saveConfig()" placeholder="Discord webhook">
            </div>

            <div id="zonesTab" class="tab-content">
                <h3>Add Zone</h3>
                <input class="form-input" id="zoneName" placeholder="Zone name">
                <input class="form-input" id="zoneUpper" type="number" placeholder="Upper price">
                <input class="form-input" id="zoneLower" type="number" placeholder="Lower price">
                <select class="form-select" id="zoneFVG">
                    <option value="none">No FVG</option>
                    <option value="bullish">Bullish FVG</option>
                    <option value="bearish">Bearish FVG</option>
                    <option value="both">Both FVG</option>
                </select>
                <select class="form-select" id="zoneCHoCH">
                    <option value="none">No CHoCH</option>
                    <option value="bullish">Bullish CHoCH</option>
                    <option value="bearish">Bearish CHoCH</option>
                    <option value="both">Both CHoCH</option>
                </select>
                <button class="btn btn-primary" onclick="addZone()">Add Zone</button>
                <div id="zonesList" style="margin-top:15px"></div>
            </div>

            <div id="advancedTab" class="tab-content">
                <label>Alarm</label>
                <select class="form-select" id="alarmInput" onchange="saveConfig()">
                    <option value="beep">Beep</option>
                    <option value="bell">Bell</option>
                    <option value="none">None</option>
                </select>
            </div>
        </div>

        <div class="card">
            <h3>Signals</h3>
            <div id="signalsList"><p style="text-align:center;color:#64748b">No signals</p></div>
        </div>
    </div>

    <script>
        function switchTab(e,tab){document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));e.target.classList.add('active');document.getElementById(tab+'Tab').classList.add('active');}

        let bot={isRunning:false,symbol:'BTCUSDT',timeframe:'15m',webhook:'',alarmSound:'beep',zones:[],signals:[],stats:{total:0,bullish:0,bearish:0},sentSignals:new Set(),intervalId:null,lastPivots:{high:[],low:[]}};

        function loadConfig(){const saved=localStorage.getItem('bot');if(saved){const d=JSON.parse(saved);bot={...bot,...d};bot.sentSignals=new Set(d.sentSignals||[]);}document.getElementById('symbolInput').value=bot.symbol;document.getElementById('timeframeInput').value=bot.timeframe;document.getElementById('webhookInput').value=bot.webhook;document.getElementById('alarmInput').value=bot.alarmSound;updateDisplay();renderZones();}

        function saveConfig(){bot.symbol=document.getElementById('symbolInput').value;bot.timeframe=document.getElementById('timeframeInput').value;bot.webhook=document.getElementById('webhookInput').value;bot.alarmSound=document.getElementById('alarmInput').value;localStorage.setItem('bot',JSON.stringify({...bot,sentSignals:Array.from(bot.sentSignals)}));updateDisplay();}

        function toggleConfig(){document.getElementById('configPanel').classList.toggle('show');}

        function addZone(){const name=document.getElementById('zoneName').value;const upper=parseFloat(document.getElementById('zoneUpper').value);const lower=parseFloat(document.getElementById('zoneLower').value);const fvg=document.getElementById('zoneFVG').value;const choch=document.getElementById('zoneCHoCH').value;if(!name||!upper||!lower||upper<=lower){alert('Invalid zone');return;}bot.zones.push({id:Date.now(),name,upper,lower,fvg,choch,broken:false});document.getElementById('zoneName').value='';document.getElementById('zoneUpper').value='';document.getElementById('zoneLower').value='';saveConfig();renderZones();}

        function removeZone(id){bot.zones=bot.zones.filter(z=>z.id!==id);saveConfig();renderZones();}

        function renderZones(){const list=document.getElementById('zonesList');if(!bot.zones.length){list.innerHTML='<p style="color:#64748b">No zones</p>';return;}list.innerHTML=bot.zones.map(z=>`<div class="zone-item ${z.broken?'broken':''}"><strong>${z.name}</strong> ${z.broken?'(BROKEN)':''}<br>$${z.lower}-$${z.upper}<br><small>FVG:${z.fvg} CHoCH:${z.choch}</small><br><button class="btn" style="margin-top:5px;font-size:11px" onclick="removeZone(${z.id})">Remove</button></div>`).join('');}

        function toggleBot(){if(!bot.webhook){alert('Set webhook!');toggleConfig();return;}bot.isRunning?stopBot():startBot();}

        function startBot(){bot.isRunning=true;document.getElementById('statusText').textContent='Running';document.getElementById('toggleBtn').textContent='Stop';document.getElementById('toggleBtn').className='btn btn-stop';checkMarket();bot.intervalId=setInterval(checkMarket,60000);}

        function stopBot(){bot.isRunning=false;document.getElementById('statusText').textContent='Stopped';document.getElementById('toggleBtn').textContent='Start';document.getElementById('toggleBtn').className='btn btn-start';if(bot.intervalId)clearInterval(bot.intervalId);}

        async function checkMarket(){try{const candles=await fetchCandles();if(!candles||candles.length<10)return;const price=candles[candles.length-1][4];checkZones(candles,price);const fvgs=detectFVG(candles);if(!fvgs.length)return;const fvg=fvgs[fvgs.length-1];const choch=detectCHoCH(candles);const zone=bot.zones.find(z=>!z.broken&&price>=z.lower&&price<=z.upper);if(!zone)return;const fvgOk=zone.fvg==='none'||zone.fvg===fvg.type||zone.fvg==='both';const chochOk=zone.choch==='none'||(choch&&(zone.choch===choch.type||zone.choch==='both'));if(!fvgOk&&!chochOk)return;const signal={id:Date.now(),type:fvg.type,price,zone:zone.name,fvg:true,choch:choch?true:false,timestamp:new Date().toISOString()};bot.signals.unshift(signal);bot.signals=bot.signals.slice(0,20);bot.stats.total++;if(fvg.type==='bullish')bot.stats.bullish++;else bot.stats.bearish++;await sendToDiscord(signal);playAlarm();saveConfig();updateDisplay();}catch(e){}}

        function checkZones(candles,price){bot.zones.forEach(z=>{if(z.broken)return;const close=candles[candles.length-1][4];const prevClose=candles[candles.length-2][4];if((close>z.upper&&prevClose<=z.upper)||(close<z.lower&&prevClose>=z.lower)){z.broken=true;alert(`Zone "${z.name}" BROKEN`);}});saveConfig();renderZones();}

        async function fetchCandles(){const res=await fetch(`https://api.binance.com/api/v3/klines?symbol=${bot.symbol}&interval=${bot.timeframe}&limit=50`);const d=await res.json();return d.map(c=>[parseInt(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]),parseFloat(c[4])]);}

        function detectFVG(candles){const fvgs=[];for(let i=2;i<candles.length;i++){if(candles[i][3]>candles[i-2][2]){fvgs.push({type:'bullish',top:candles[i][3],bottom:candles[i-2][2],timestamp:candles[i][0]});}else if(candles[i][2]<candles[i-2][3]){fvgs.push({type:'bearish',top:candles[i-2][3],bottom:candles[i][2],timestamp:candles[i][0]});}}return fvgs;}

        function detectCHoCH(candles){const len=5;let highs=[],lows=[];for(let i=len;i<candles.length-len;i++){const isHigh=candles.slice(i-len,i+len+1).every((c,idx)=>idx===len||c[2]<=candles[i][2]);const isLow=candles.slice(i-len,i+len+1).every((c,idx)=>idx===len||c[3]>=candles[i][3]);if(isHigh)highs.push({price:candles[i][2],index:i});if(isLow)lows.push({price:candles[i][3],index:i});}if(highs.length>=2&&lows.length>=2){const lastHigh=highs[highs.length-1];const prevHigh=highs[highs.length-2];const lastLow=lows[lows.length-1];const prevLow=lows[lows.length-2];if(lastLow.index>lastHigh.index&&lastLow.price>prevLow.price)return{type:'bullish'};if(lastHigh.index>lastLow.index&&lastHigh.price<prevHigh.price)return{type:'bearish'};}return null;}

        async function sendToDiscord(signal){const embed={title:`üéØ ${signal.type.toUpperCase()} SIGNAL`,description:`Zone: ${signal.zone}\nPrice: $${signal.price.toFixed(2)}`,color:signal.type==='bullish'?3066993:15158332,fields:[{name:'Pattern',value:`${signal.fvg?'FVG ':''}${signal.choch?'CHoCH':''}`}]};await fetch(bot.webhook,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({embeds:[embed]})});}

        function playAlarm(){if(bot.alarmSound==='none')return;const ctx=new AudioContext();const osc=ctx.createOscillator();const gain=ctx.createGain();osc.connect(gain);gain.connect(ctx.destination);osc.frequency.value=800;gain.gain.setValueAtTime(0.3,ctx.currentTime);gain.gain.exponentialRampToValueAtTime(0.01,ctx.currentTime+0.3);osc.start();osc.stop(ctx.currentTime+0.3);}

        function updateDisplay(){document.getElementById('symbolDisplay').textContent=`${bot.symbol} ‚Ä¢ ${bot.timeframe}`;document.getElementById('totalSignals').textContent=bot.stats.total;document.getElementById('bullishSignals').textContent=bot.stats.bullish;document.getElementById('bearishSignals').textContent=bot.stats.bearish;const list=document.getElementById('signalsList');if(!bot.signals.length){list.innerHTML='<p style="text-align:center;color:#64748b">No signals</p>';return;}list.innerHTML=bot.signals.map(s=>`<div class="signal ${s.type}"><strong style="color:${s.type==='bullish'?'#22c55e':'#ef4444'}">${s.type.toUpperCase()}</strong><br>Zone: ${s.zone}<br>Price: $${s.price.toFixed(2)}<br><span class="signal-badge fvg">FVG</span>${s.choch?'<span class="signal-badge choch">CHoCH</span>':''}<br><small>${new Date(s.timestamp).toLocaleString()}</small></div>`).join('');}

        loadConfig();
    </script>
</body>
</html>
